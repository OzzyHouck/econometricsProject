---
title: "Econometrics Final Project"
author: "Ozzy Houck"
date: "May 15, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(boxoffice)
library(tidyverse)
library(lubridate)
library(textclean)

```

```{r}
nominees <- read.csv("nominees.csv")
bestPicture <- subset(nominees, category == "BEST PICTURE" & year > 2007, select = year:entity)
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "True", entity = "Green Book")
bestPicture <-add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Bohemian Rhapsody")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "The Favourite")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Black Panther")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "BlackKkKlansman")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Vice")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "A Star is Born")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Roma")
bestPicture <- bestPicture %>% 
  mutate(entity = ifelse(entity == "Birdman or (The Unexpected Virtue of Ignorance)", "Birdman", entity))
```

#instead of looking at percent change we could look at absolute gross. In which case we would also need budget. 

#Nominations announced on January 22, 2019 
#Awards ceremony was February 24, 2019

#Day of Oscar announcment Feb 4 2017
# Day of Oscar ceremony Feb 26 2017
```{r}
ceremonyDates <- c("2019/2/24", "2018/3/04", "2017/2/26",  "2016/2/28","2015/2/22", "2014/3/02", "2013/2/24", "2012/2/26", "2011/2/27", "2010/3/07")

findCeremonyDate <- function(date) 
{
  yearOnly <- year(date)
  for (i in ceremonyDates)
  {
    if (year(i) == yearOnly)
    {
      return(i)
    }
  }
  return(NULL)
}

awardDates <- c()

for (i in ceremonyDates)
{
  dates <- format(seq(from = as.Date(i) - 14, to = as.Date(i) + 14, by = "day"),
                  format="%Y/%m/%d")
  awardDates <- c(awardDates, dates)
}
awardDates <- as.Date(awardDates)

awardSeason <- boxoffice(dates = awardDates)
 
#filters our awards season data by nominees 

winners <- c("Green Book", "The Shape of Water", "Moonlight", "Spotlight", "Birdman", "12 Years a Slave", "Argo", "The Artist", "The King’s Speech", "The Hurt Locker")
nominees <- c("Green Book", "The Shape of Water", "Moonlight", "Spotlight", "Birdman", "12 Years a Slave", "Argo", "The Artist", "The King’s Speech", "Roma", "The Favourite", "Black Panther", "A Star is Born", "BlacKkKlansman", "Bohemian Rhapsody", "Vice", "Three Billboards Outside Eb…", "Dunkirk", "Lady Bird", "Get Out", "The Post", "Darkest Hour", "Call Me by Your Name", "Phantom Thread", "La La Land", "Manchester-by-the Sea", "Hidden Figures", "Fences", "Arrival", "Hacksaw Ridge", "Hell or High Water", "Lion", "The Revenant", "The Big Short", "The Martian", "Mad Max: Fury Road", "Room", "Bridge of Spies", "Brooklyn", "American Sniper", "Boyhood", "The Grand Budapest Hotel", "The Imitation Game", "Selma", "The Theory of Everything", "Whiplash", "Gravity", "American Hustle", "Dallas Buyers Club", "Her", "Philomena", "The Wolf of Wall Street", "Captain Phillips", "Nebraska", "Lincoln", "Zero Dark Thirty", "Les Miserables", "Life of Pi", "Silver Linings Playbook", "Django Unchained", "Armour", "Beasts of the Southern Wild", "The Help", "The Descendants", "Hugo", "Midnight in Paris", "Moneyball", "The Tree of Life", "War Hoarse", "Extremely Loud and Incredib…", "127 Hours", "Black Swan", "The Fighter", "Inception", "The Kids Are All Right", "The Social Network", "Toy Story 3", "True Grit", "Winter's Bone")
df <- awardSeason %>%
  mutate(viewership = cut(year(date), breaks = c(2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019), labels = c(37.6, 39.3, 40.3, 43.7, 36.6, 34.3, 32.9, 26.5, 29.6))) %>% 
  mutate(movie = ifelse(movie == "Birdman or (The Unexpected …", "Birdman", movie)) %>% 
  filter(movie %in% nominees) %>%  
  filter(movie != "Black Panther") %>%  #in theaters during previous award season
  mutate(winner = ifelse(movie %in% winners, 1, 0)) %>% #dummy to denote a winner
  group_by(date) %>% 
  mutate(movie2 = ifelse(date <= findCeremonyDate(date), sub("^", "Before: ", movie) , movie)) %>%  #Add new column which divides the movie names into before and after.
  ungroup() %>% 
  drop_na()
df <- df %>% 
  left_join(df %>% #weird thing in which I calculate the percentage change for each movie in each timer period and then join those values to the big table
              group_by(movie2) %>% 
              summarise(meanChange = mean(percent_change)), by = "movie2") %>% 
  group_by(movie2) %>% 
  slice(n()) # takes entry for each movie in each time period

df <- df %>% 
  left_join(df %>% 
              group_by(movie) %>%
              summarise(diffMeanChange = meanChange[2] - meanChange[1]), by = "movie") %>% 
  group_by(movie) %>% 
  filter(!grepl('Before:', movie2)) %>% 
  drop_na()



```
Dates of Oscar ceromonies

	February 24, 2019: Green Book
	March 4, 2018: The Shape of Water
	February 26, 2017: Moonlight
	February 28, 2016: Spotlight
	February 22, 2015: Birdman
	March 2, 2014: 12 Years a Slave
	February 24, 2013: Argo
	February 26, 2012: The Artist
	February 27, 2011: The King's Speech
	March 7, 2010: The Hurt Locker
	
	
	
	
Creating Summary Statistics and visualizations

```{r}
ggplot(df, aes(x = date, y = diffMeanChange, color = as.factor(winner))) +
  geom_point() 
```


Let's be stupid and prematurly run a regression!
```{r}
model <- lm(diffMeanChange ~ days + winner + as.numeric(viewership), data = df)
summary(model)
```
2019  29.6
2018	26.5
2017	32.9
2016	34.3
2015	36.6
2014	43.7
2013	40.3
2012	39.3
2011	37.6




