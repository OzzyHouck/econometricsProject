---
title: "Econometrics Final Project"
author: "Ozzy Houck"
date: "May 15, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(boxoffice)
library(tidyverse)
library(lubridate)
library(textclean)

```

```{r}
nominees <- read.csv("nominees.csv")
bestPicture <- subset(nominees, category == "BEST PICTURE" & year > 2007, select = year:entity)
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "True", entity = "Green Book")
bestPicture <-add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Bohemian Rhapsody")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "The Favourite")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Black Panther")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "BlackKkKlansman")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Vice")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "A Star is Born")
bestPicture <- add_row(bestPicture, year = "2018", category = "BEST PICTURE", winner = "False", entity = "Roma")
```

#instead of looking at percent change we could look at absolute gross. In which case we would also need budget. 

#Nominations announced on January 22, 2019 
#Awards ceremony was February 24, 2019

#Day of Oscar announcment Feb 4 2017
# Day of Oscar ceremony Feb 26 2017
```{r}
ceremonyDates <- c("2019/2/24", "2018/3/04", "2017/2/26",  "2016/2/28","2015/2/22", "2014/3/02", "2013/2/24", "2012/2/26", "2011/2/27", "2010/3/07")

findCeremonyDate <- function(date) 
{
  yearOnly <- year(date)
  for (i in ceremonyDates)
  {
    if (year(i) == yearOnly)
    {
      return(i)
    }
  }
  return(NULL)
}

awardDates <- c()

for (i in ceremonyDates)
{
  dates <- format(seq(from = as.Date(i) - 14, to = as.Date(i) + 14, by = "day"),
                  format="%Y/%m/%d")
  awardDates <- c(awardDates, dates)
}
awardDates <- as.Date(awardDates)

awardSeason <- boxoffice(dates = awardDates)
awardSeasonNominees <- awardSeason %>% 
      filter(replace_non_ascii(awardSeason$movie, replacement = "", remove.nonconverted = TRUE) %in% replace_non_ascii(bestPicture$entity, replacement = "", remove.nonconverted = TRUE)) 

winners <- c("Green Book", "The Shape of Water", "Moonlight", "Spotlight", "Birdman", "12 Years a Slave", "Argo", "The Artist", "The King's Speech", "The Hurt Locker")

df <- awardSeasonNominees %>% 
  filter(movie != "Black Panther") %>%  #in theaters during previous award season
  mutate(winner = ifelse(movie %in% winners, 1, 0)) %>% #dummy to denote a winner
  group_by(date) %>% 
  mutate(movie2 = ifelse(date <= findCeremonyDate(date), sub("^", "Before: ", movie) , movie)) %>%  #Add new column which divides the movie names into before and after.
  ungroup() %>% 
  drop_na()
df <- df %>% 
  left_join(df %>% #weird thing in which I calculate the percentage change for each movie in each timer period and then join those values to the big table
              group_by(movie2) %>% 
              summarise(meanChange = mean(percent_change)), by = "movie2") %>% 
  group_by(movie2) %>% 
  slice(n()) # takes entry for each movie in each time period

df <- df %>% 
  left_join(df %>% 
              group_by(movie) %>%
              summarise(diffMeanChange = meanChange[2] - meanChange[1]), by = "movie") %>% 
  group_by(movie) %>% 
  slice(n()) %>% 
  drop_na()

```
Dates of Oscar ceromonies

	February 24, 2019: Green Book
	March 4, 2018: The Shape of Water
	February 26, 2017: Moonlight
	February 28, 2016: Spotlight
	February 22, 2015: Birdman
	March 2, 2014: 12 Years a Slave
	February 24, 2013: Argo
	February 26, 2012: The Artist
	February 27, 2011: The King's Speech
	March 7, 2010: The Hurt Locker
	
	
	
	
Creating Summary Statistics and visualizations

```{r}
ggplot(df, aes(x = date, y = diffMeanChange, color = as.factor(winner))) +
  geom_point() 
```


Let's be stupid and prematurly run a regression!
```{r}
model <- lm(diffMeanChange ~ days + winner, data = df)
summary(model)
```


